{"version":3,"file":"dialog.bundle.js","sources":["../src/dialog.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Dialog Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport './dialog.css';\nimport 'main.polyfill.intersectionobserver';\nimport {Vue} from 'ui.vue';\nimport {Vuex} from 'ui.vue.vuex';\nimport 'im.component.message';\nimport {DeviceType, MutationType, DialogReferenceClassName, DialogType} from \"im.const\";\nimport {Utils as MessengerUtils} from \"im.utils\";\nimport {Animation} from \"im.tools.animation\";\n\nconst TemplateType = Object.freeze({\n\tmessage: 'message',\n\tdelimiter: 'delimiter',\n\tgroup: 'group',\n\thistoryLoader: 'historyLoader',\n\tunreadLoader: 'unreadLoader',\n\tbutton: 'button',\n});\n\nconst ObserverType = Object.freeze({\n\thistory: 'history',\n\tunread: 'unread',\n\tread: 'read',\n\tnone: 'none',\n});\n\nconst LoadButtonTypes = Object.freeze({\n\tbefore: 'before',\n\tafter: 'after'\n});\n\nconst AnimationType = Object.freeze({\n\tnone: 'none',\n\tmixed: 'mixed',\n\tenter: 'enter',\n\tleave: 'leave',\n});\n\nVue.component('bx-messenger-dialog',\n{\n\t/**\n\t * @emits 'requestHistory' {lastId: number, limit: number}\n\t * @emits 'requestUnread' {lastId: number, limit: number}\n\t * @emits 'readMessage' {id: number}\n\t * @emits 'quoteMessage' {message: object}\n\t * @emits 'click' {event: MouseEvent}\n\t * @emits 'clickByUserName' {user: object, event: MouseEvent}\n\t * @emits 'clickByUploadCancel' {file: object, event: MouseEvent}\n\t * @emits 'clickByKeyboardButton' {message: object, action: string, params: Object}\n\t * @emits 'clickByMessageMenu' {message: object, event: MouseEvent}\n\t * @emits 'clickByCommand' {type: string, value: string, event: MouseEvent}\n\t * @emits 'clickByMention' {type: string, value: string, event: MouseEvent}\n\t * @emits 'clickByMessageRetry' {message: object, event: MouseEvent}\n\t * @emits 'clickByReadedList' {list: array, event: MouseEvent}\n\t * @emits 'setMessageReaction' {message: object, reaction: object}\n\t * @emits 'openMessageReactionList' {message: object, values: object}\n\t */\n\n\t/**\n\t * @listens props.listenEventScrollToBottom {force:boolean, cancelIfScrollChange:boolean} (global|application) -- scroll dialog to bottom, see more in methods.onScrollToBottom()\n\t * @listens props.listenEventRequestHistory {count:number} (application)\n\t * @listens props.listenEventRequestUnread {count:number} (application)\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tchatId: { default: 0 },\n\t\tmessageLimit: { default: 20 },\n\t\tmessageExtraCount: { default: 0 },\n\t\tlistenEventScrollToBottom: { default: '' },\n\t\tlistenEventRequestHistory: { default: '' },\n\t\tlistenEventRequestUnread: { default: '' },\n\t\tenableReactions: { default: true },\n\t\tenableDateActions: { default: true },\n\t\tenableCreateContent: { default: true },\n\t\tenableGestureQuote: { default: true },\n\t\tenableGestureMenu: { default: false },\n\t\tshowMessageUserName: { default: true },\n\t\tshowMessageAvatar: { default: true },\n\t\tshowMessageMenu: { default: true },\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tscrollAnimating: false,\n\t\t\tshowScrollButton: false,\n\t\t\tmessageShowCount: 0,\n\t\t\tunreadLoaderShow: false,\n\t\t\thistoryLoaderBlocked: false,\n\t\t\thistoryLoaderShow: true,\n\t\t\tstartMessageLimit: 0,\n\t\t\ttemplateMessageScrollOffset: 20,\n\t\t\ttemplateMessageWithNameDifferent: 29, // name block + padding top\n\t\t\tTemplateType: TemplateType,\n\t\t\tObserverType: ObserverType,\n\t\t\tDialogReferenceClassName: DialogReferenceClassName,\n\t\t\tcaptureMove: false,\n\t\t\tcapturedMoveEvent: null,\n\t\t\tlastMessageId: null,\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.showScrollButton = this.unreadCounter > 0;\n\n\t\tthis.scrollChangedByUser = false;\n\t\tthis.scrollButtonDiff = 100;\n\t\tthis.scrollButtonShowTimeout = null;\n\t\tthis.scrollPosition = 0;\n\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\n\t\tthis.animationScrollHeightStart = 0;\n\t\tthis.animationScrollHeightEnd = 0;\n\t\tthis.animationScrollTop = 0;\n\t\tthis.animationScrollChange = 0;\n\t\tthis.animationScrollLastUserId = 0;\n\t\tthis.animationType = AnimationType.none;\n\t\tthis.animationCollection = [];\n\t\tthis.animationCollectionOffset = {};\n\t\tthis.animationLastElementBeforeStart = 0;\n\n\t\tthis.observers = {};\n\n\t\tthis.requestHistoryInterval = null;\n\t\tthis.requestUnreadInterval = null;\n\n\t\tthis.lastAuthorId = 0;\n\t\tthis.firstMessageId = null;\n\t\tthis.firstUnreadMessageId = null;\n\t\tthis.dateFormatFunction = null;\n\t\tthis.cacheGroupTitle = {};\n\n\t\tthis.waitLoadHistory = false;\n\t\tthis.waitLoadUnread = false;\n\t\tthis.skipUnreadScroll = false;\n\n\t\tthis.readMessageQueue = [];\n\t\tthis.readMessageTarget = {};\n\t\tthis.readMessageDelayed = MessengerUtils.debounce(this.readMessage, 50, this);\n\n\t\tthis.requestHistoryBlockIntersect = false;\n\t\tthis.requestHistoryDelayed = MessengerUtils.debounce(this.requestHistory, 50, this);\n\n\t\tthis.requestUnreadBlockIntersect = false;\n\t\tthis.requestUnreadDelayed = MessengerUtils.debounce(this.requestUnread, 50, this);\n\n\t\tthis.startMessageLimit = this.messageLimit;\n\n\t\tif (this.listenEventScrollToBottom)\n\t\t{\n\t\t\tVue.event.$on(this.listenEventScrollToBottom, this.onScrollToBottom);\n\t\t\tthis.$root.$on(this.listenEventScrollToBottom, this.onScrollToBottom);\n\t\t}\n\t\tif (this.listenEventRequestHistory)\n\t\t{\n\t\t\tthis.$root.$on(this.listenEventRequestHistory, this.onRequestHistoryAnswer);\n\t\t}\n\t\tif (this.listenEventRequestUnread)\n\t\t{\n\t\t\tthis.$root.$on(this.listenEventRequestUnread, this.onRequestUnreadAnswer);\n\t\t}\n\n\t\twindow.addEventListener(\"orientationchange\", this.onOrientationChange);\n\t\twindow.addEventListener('focus', this.onWindowFocus);\n\t\twindow.addEventListener('blur', this.onWindowBlur);\n\n\t\tVue.event.$on('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\tVue.event.$on('bitrixmobile:controller:blur', this.onWindowBlur);\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.observers = {};\n\n\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\tclearInterval(this.requestHistoryInterval);\n\t\tclearInterval(this.requestUnreadInterval);\n\n\t\tif (this.listenEventScrollToBottom)\n\t\t{\n\t\t\tVue.event.$off(this.listenEventScrollToBottom, this.onScrollToBottom);\n\t\t\tthis.$root.$off(this.listenEventScrollToBottom, this.onScrollToBottom);\n\t\t}\n\t\tif (this.listenEventRequestHistory)\n\t\t{\n\t\t\tthis.$root.$off(this.listenEventRequestHistory, this.onRequestHistoryAnswer);\n\t\t}\n\t\tif (this.listenEventRequestUnread)\n\t\t{\n\t\t\tthis.$root.$off(this.listenEventRequestUnread, this.onRequestUnreadAnswer);\n\t\t}\n\n\t\twindow.removeEventListener(\"orientationchange\", this.onOrientationChange);\n\t\twindow.removeEventListener('focus', this.onWindowFocus);\n\t\twindow.removeEventListener('blur', this.onWindowBlur);\n\n\t\tVue.event.$off('bitrixmobile:controller:focus', this.onWindowFocus);\n\t\tVue.event.$off('bitrixmobile:controller:blur', this.onWindowBlur);\n\t},\n\tmounted()\n\t{\n\t\tlet unreadId = Utils.getFirstUnreadMessage(this.collection);\n\t\tif (unreadId)\n\t\t{\n\t\t\tUtils.scrollToFirstUnreadMessage(this, this.collection, unreadId, true)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet body = this.$refs.body;\n\t\t\tUtils.scrollToPosition(this, body.scrollHeight - body.clientHeight);\n\t\t}\n\t\tthis.windowFocused = MessengerUtils.platform.isBitrixMobile()? true: document.hasFocus();\n\t},\n\tcomputed:\n\t{\n\t\tlocalize()\n\t\t{\n\t\t\treturn Vue.getFilteredPhrases('IM_MESSENGER_DIALOG_', this.$root.$bitrixMessages);\n\t\t},\n\t\tdialog()\n\t\t{\n\t\t\tlet dialog = this.$store.getters['dialogues/get'](this.dialogId);\n\t\t\treturn dialog? dialog: this.$store.getters['dialogues/getBlank']();\n\t\t},\n\t\tcollectionMutationType()\n\t\t{\n\t\t\treturn this.$store.getters['messages/getMutationType'](this.chatId);\n\t\t},\n\t\tcollection()\n\t\t{\n\t\t\treturn this.$store.getters['messages/get'](this.chatId);\n\t\t},\n\t\telementsWithLimit()\n\t\t{\n\t\t\tlet unreadCount = this.collection.filter(element => element.unread).length;\n\t\t\tlet showLimit = this.messageExtraCount + this.messageLimit * 2;\n\t\t\tif (unreadCount > showLimit)\n\t\t\t{\n\t\t\t\tshowLimit = unreadCount;\n\t\t\t}\n\n\t\t\tlet start = this.collection.length - showLimit;\n\t\t\tif (!this.historyLoaderShow || start < 0)\n\t\t\t{\n\t\t\t\tstart = 0;\n\t\t\t}\n\n\t\t\tlet collection = [];\n\t\t\tlet lastAuthorId = 0;\n\t\t\tlet groupNode = {};\n\n\t\t\tlet slicedCollection = start === 0? this.collection: this.collection.slice(start, this.collection.length);\n\n\t\t\tthis.messageShowCount = slicedCollection.length;\n\n\t\t\tif (this.messageShowCount > 0)\n\t\t\t{\n\t\t\t\tthis.firstMessageId = slicedCollection[0].id;\n\t\t\t\tthis.lastMessageId = slicedCollection[slicedCollection.length-1].id;\n\t\t\t\tthis.lastMessageAuthorId = slicedCollection[slicedCollection.length-1].authorId;\n\t\t\t}\n\n\t\t\tthis.firstUnreadMessageId = 0;\n\t\t\tlet unreadCountInSlicedCollection = 0;\n\t\t\tslicedCollection.forEach(element =>\n\t\t\t{\n\t\t\t\tlet group = this._groupTitle(element.date);\n\t\t\t\tif (!groupNode[group.title])\n\t\t\t\t{\n\t\t\t\t\tgroupNode[group.title] = group.id;\n\t\t\t\t\tcollection.push(Blocks.getGroup(group.id, group.title));\n\t\t\t\t}\n\t\t\t\telse if (lastAuthorId !== element.authorId)\n\t\t\t\t{\n\t\t\t\t\tcollection.push(Blocks.getDelimiter(element.id));\n\t\t\t\t}\n\n\t\t\t\tcollection.push(element);\n\n\t\t\t\tlastAuthorId = element.authorId;\n\n\t\t\t\tif (element.unread)\n\t\t\t\t{\n\t\t\t\t\tif (!this.firstUnreadMessageId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.firstUnreadMessageId = element.id;\n\t\t\t\t\t}\n\t\t\t\t\tunreadCountInSlicedCollection++;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\tthis.collection.length >= this.messageLimit\n\t\t\t\t&& this.collection.length >= this.messageShowCount\n\t\t\t\t&& this.historyLoaderBlocked === false\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.historyLoaderShow = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.historyLoaderShow = false;\n\t\t\t}\n\n\t\t\tif (this.dialog.unreadLastId > this.lastMessageId)\n\t\t\t{\n\t\t\t\tthis.unreadLoaderShow = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unreadLoaderShow = false;\n\t\t\t}\n\n\t\t\treturn collection;\n\t\t},\n\t\tstatusWriting()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.writingList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.scrollTo({duration: 500}), 300);\n\t\t\t}\n\n\t\t\treturn this.localize.IM_MESSENGER_DIALOG_WRITES_MESSAGE.replace(\n\t\t\t\t'#USER#', this.dialog.writingList.map(element => element.userName).join(', ')\n\t\t\t);\n\t\t},\n\t\tstatusReaded()\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.dialog.readedList.length === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet text = '';\n\n\t\t\tif (this.dialog.type === DialogType.private)\n\t\t\t{\n\t\t\t\tlet record = this.dialog.readedList[0];\n\t\t\t\tif (\n\t\t\t\t\trecord.messageId === this.lastMessageId\n\t\t\t\t\t&& record.userId !== this.lastMessageAuthorId\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tlet dateFormat = MessengerUtils.date.getFormatType(\n\t\t\t\t\t\tBX.Messenger.Const.DateFormat.readedTitle,\n\t\t\t\t\t\tthis.$root.$bitrixMessages\n\t\t\t\t\t);\n\n\t\t\t\t\ttext = this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_USER.replace(\n\t\t\t\t\t\t'#DATE#', this._getDateFormat().format(dateFormat, record.date)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet readedList = this.dialog.readedList.filter(record => record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId);\n\t\t\t\tif (readedList.length === 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT.replace(\n\t\t\t\t\t\t'#USERS#', readedList[0].userName\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse if (readedList.length > 1)\n\t\t\t\t{\n\t\t\t\t\ttext = this.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT.replace(\n\t\t\t\t\t\t'#USERS#',\n\t\t\t\t\t\tthis.localize.IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT_PLURAL\n\t\t\t\t\t\t\t\t.replace('#USER#', readedList[0].userName)\n\t\t\t\t\t\t\t\t.replace('#COUNT#', readedList.length-1)\n\t\t\t\t\t\t\t\t.replace('[LINK]', '')\n\t\t\t\t\t\t\t\t.replace('[/LINK]', '')\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (!this.scrollChangedByUser && !this.showScrollButton)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.scrollTo({duration: 500}), 300);\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\t\tunreadCounter()\n\t\t{\n\t\t\treturn this.dialog.counter > 999? 999: this.dialog.counter;\n\t\t},\n\t\tscrollBlocked()\n\t\t{\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.scrollAnimating || this.captureMove;\n\t\t},\n\t\tisDarkBackground()\n\t\t{\n\t\t\treturn this.application.options.darkBackground;\n\t\t},\n\t\tisMobile()\n\t\t{\n\t\t\treturn this.application.device.type === DeviceType.mobile;\n\t\t},\n\n\t\tAnimationType: () => AnimationType,\n\n\t\t...Vuex.mapState({\n\t\t\tapplication: state => state.application,\n\t\t})\n\t},\n\tmethods:\n\t{\n\t\tonDialogClick(event)\n\t\t{\n\t\t\tif (Vue.testNode(event.target, {className: 'bx-im-message-command'}))\n\t\t\t{\n\t\t\t\tthis.onCommandClick(event);\n\t\t\t}\n\t\t\telse if (Vue.testNode(event.target, {className: 'bx-im-mention'}))\n\t\t\t{\n\t\t\t\tthis.onMentionClick(event);\n\t\t\t}\n\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.$emit('click', {event});\n\t\t},\n\t\tonDialogMove(event)\n\t\t{\n\t\t\tif (!this.captureMove)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.capturedMoveEvent = event;\n\t\t},\n\t\tonCommandClick(event)\n\t\t{\n\t\t\tlet value = '';\n\n\t\t\tif (\n\t\t\t\tevent.target.dataset.entity === 'send'\n\t\t\t\t|| event.target.dataset.entity === 'put'\n\t\t\t)\n\t\t\t{\n\t\t\t\tvalue = event.target.nextSibling.innerHTML;\n\t\t\t}\n\t\t\telse if (event.target.dataset.entity === 'call')\n\t\t\t{\n\t\t\t\tvalue = event.target.dataset.command;\n\t\t\t}\n\n\t\t\tthis.$emit('clickByCommand', {type: event.target.dataset.entity, value, event});\n\t\t},\n\t\tonMentionClick(event)\n\t\t{\n\t\t\tthis.$emit('clickByMention', {type: event.target.dataset.type, value: event.target.dataset.value, event});\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tthis.scrollPosition = event.target.scrollTop;\n\t\t\tthis.scrollPositionChangeTime = new Date().getTime();\n\n\t\t\tthis.scrollChangedByUser = !(event.target.scrollTop + this.scrollButtonDiff >= event.target.scrollHeight - event.target.clientHeight);\n\n\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\t\t\tthis.scrollButtonShowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.scrollChangedByUser)\n\t\t\t\t{\n\t\t\t\t\tif (!this.showScrollButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (this.showScrollButton && !this.unreadLoaderShow)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 200);\n\n\t\t\tif (event.target.scrollTop === event.target.scrollHeight - event.target.offsetHeight)\n\t\t\t{\n\t\t\t\tclearTimeout(this.scrollButtonShowTimeout);\n\n\t\t\t\tif (this.showScrollButton && !this.unreadLoaderShow)\n\t\t\t\t{\n\t\t\t\t\tthis.showScrollButton = false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tscrollToBottom(params = {})\n\t\t{\n\t\t\tlet {\n\t\t\t\tforce = false,\n\t\t\t\tcancelIfScrollChange = false,\n\t\t\t\tduration = null\n\t\t\t} = params;\n\n\t\t\tif (cancelIfScrollChange && this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet body = this.$refs.body;\n\n\t\t\tif (this.dialog.counter > 0)\n\t\t\t{\n\t\t\t\tlet scrollToMessageId = this.dialog.counter > 1 && this.firstUnreadMessageId? this.firstUnreadMessageId: this.lastMessageId;\n\t\t\t\tUtils.scrollToFirstUnreadMessage(this, this.collection, scrollToMessageId);\n\n\t\t\t\tif (this.dialog.counter < this.startMessageLimit)\n\t\t\t\t{\n\t\t\t\t\tthis.historyLoaderShow = true;\n\t\t\t\t\tthis.historyLoaderBlocked = false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.showScrollButton = false;\n\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tUtils.scrollToPosition(this, body.scrollHeight - body.clientHeight);\n\n\t\t\t\tif (this.messageExtraCount)\n\t\t\t\t{\n\t\t\t\t\tthis.$store.commit('application/clearDialogExtraCount');\n\t\t\t\t}\n\t\t\t\tthis.historyLoaderShow = true;\n\t\t\t\tthis.historyLoaderBlocked = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet scrollParams = {};\n\t\t\t\tif (duration)\n\t\t\t\t{\n\t\t\t\t\tscrollParams.duration = duration;\n\t\t\t\t}\n\t\t\t\tthis.scrollTo({\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tif (this.messageExtraCount)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$store.commit('application/clearDialogExtraCount');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.historyLoaderShow = true;\n\t\t\t\t\t\tthis.historyLoaderBlocked = false;\n\t\t\t\t\t},\n\t\t\t\t\t...scrollParams\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tscrollTo(params = {})\n\t\t{\n\t\t\tif (this.animateScrollId)\n\t\t\t{\n\t\t\t\tAnimation.cancel(this.animateScrollId);\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t}\n\t\t\tif (typeof params === 'function')\n\t\t\t{\n\t\t\t\tparams = {callback: params};\n\t\t\t}\n\n\t\t\tlet body = this.$refs.body;\n\t\t\tif (!body)\n\t\t\t{\n\t\t\t\tif (params.callback && typeof params.callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tparams.callback();\n\t\t\t\t}\n\t\t\t\tthis.animateScrollId = null;\n\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet {\n\t\t\t\tstart = body.scrollTop,\n\t\t\t\tend = body.scrollHeight - body.clientHeight,\n\t\t\t\tincrement = 20,\n\t\t\t\tcallback,\n\t\t\t\tduration = 500\n\t\t\t} = params;\n\n\t\t\tlet container = this.$refs.container;\n\n\t\t\tif (container && (end - start) > container.offsetHeight * 3)\n\t\t\t{\n\t\t\t\tstart = end - container.offsetHeight * 3;\n\t\t\t\tconsole.warn('Scroll trajectory has been reduced');\n\t\t\t}\n\n\t\t\tthis.scrollAnimating = true;\n\t\t\tconsole.warn('User scroll blocked while scrolling');\n\n\t\t\tthis.animateScrollId = Animation.start({\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tincrement,\n\t\t\t\tduration,\n\n\t\t\t\telement: body,\n\t\t\t\telementProperty: 'scrollTop',\n\n\t\t\t\tcallback: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.animateScrollId = null;\n\t\t\t\t\tthis.scrollAnimating = false;\n\t\t\t\t\tif (callback && typeof callback === 'function')\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tonScrollToBottom(event = {})\n\t\t{\n\t\t\tevent.force = event.force === true;\n\t\t\tevent.cancelIfScrollChange = event.cancelIfScrollChange === true;\n\n\t\t\tif (this.firstUnreadMessageId)\n\t\t\t{\n\t\t\t\tconsole.warn('onScrollToBottom canceled - unread messages');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.scrollToBottom(event);\n\n\t\t\treturn true;\n\t\t},\n\t\tonOrientationChange(event = {})\n\t\t{\n\t\t\tclearTimeout(this.scrollToTimeout);\n\n\t\t\tif (this.application.device.type !== DeviceType.mobile)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconsole.log('Orientation changed');\n\n\t\t\tif (!this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\tthis.scrollToTimeout = setTimeout(() => this.scrollToBottom({force: true}), 300);\n\t\t\t}\n\t\t},\n\t\tonWindowFocus(event = {})\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readMessage();\n\n\t\t\treturn true;\n\t\t},\n\t\tonWindowBlur(event = {})\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\trequestHistory()\n\t\t{\n\t\t\tif (!this.requestHistoryBlockIntersect)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.waitLoadHistory || !this.windowFocused || this.animateScrollId)\n\t\t\t{\n\t\t\t\tthis.requestHistoryDelayed();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.scrollPositionChangeTime + 100 > new Date().getTime()\n\t\t\t//\t|| this.$refs.body.scrollTop < 0\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.requestHistoryDelayed();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.waitLoadHistory = true;\n\n\t\t\tclearTimeout(this.waitLoadHistoryTimeout);\n\t\t\tthis.waitLoadHistoryTimeout = setTimeout(() => {\n\t\t\t\tthis.waitLoadHistory = false;\n\t\t\t}, 10000);\n\n\t\t\tlet length = this.collection.length;\n\t\t\tlet messageShowCount = this.messageShowCount;\n\t\t\tif (length > messageShowCount)\n\t\t\t{\n\t\t\t\tlet element = this.$refs.body.getElementsByClassName(DialogReferenceClassName.listItem)[0];\n\n\t\t\t\tthis.$store.commit('application/increaseDialogExtraCount', {count: this.startMessageLimit});\n\t\t\t\tUtils.scrollToElementAfterLoadHistory(this, element);\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.$emit('requestHistory', {lastId: this.firstMessageId});\n\t\t},\n\t\trequestUnread()\n\t\t{\n\t\t\tif (!this.requestUnreadBlockIntersect)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.waitLoadUnread || !this.windowFocused || this.animateScrollId)\n\t\t\t{\n\t\t\t\tthis.requestUnreadDelayed();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.scrollPositionChangeTime + 10 > new Date().getTime()\n\t\t\t\t//|| this.$refs.body.scrollTop > this.$refs.body.scrollHeight - this.$refs.body.clientHeight\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.requestUnreadDelayed();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.waitLoadUnread = true;\n\t\t\tthis.skipUnreadScroll = true;\n\n\t\t\tthis.$emit('requestUnread', {lastId: this.lastMessageId});\n\t\t},\n\t\tonRequestHistoryAnswer(event = {})\n\t\t{\n\t\t\tif (event.error)\n\t\t\t{\n\t\t\t\tthis.historyLoaderBlocked = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.historyLoaderBlocked = event.count < this.startMessageLimit;\n\t\t\t\tthis.$store.commit('application/increaseDialogExtraCount', {count: event.count});\n\t\t\t}\n\n\t\t\tif (this.historyLoaderBlocked)\n\t\t\t{\n\t\t\t\tthis.historyLoaderShow = false;\n\t\t\t}\n\n\t\t\tlet element = this.$refs.body.getElementsByClassName(DialogReferenceClassName.listItem)[0];\n\n\t\t\tif (event.count > 0)\n\t\t\t{\n\t\t\t\tif (element)\n\t\t\t\t{\n\t\t\t\t\tUtils.scrollToElementAfterLoadHistory(this, element);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (event.error)\n\t\t\t{\n\t\t\t\telement.scrollIntoView(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tUtils.scrollToPosition(this, 0);\n\t\t\t}\n\n\t\t\tclearTimeout(this.waitLoadHistoryTimeout);\n\t\t\tthis.waitLoadHistoryTimeout = setTimeout(() => {\n\t\t\t\tthis.waitLoadHistory = false;\n\t\t\t}, 1000);\n\n\t\t\treturn true;\n\t\t},\n\t\tonRequestUnreadAnswer(event = {})\n\t\t{\n\t\t\tif (event.error)\n\t\t\t{\n\t\t\t\tthis.historyLoaderBlocked = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (event.count < this.startMessageLimit)\n\t\t\t\t{\n\t\t\t\t\tthis.unreadLoaderShow = false;\n\t\t\t\t}\n\t\t\t\tthis.$store.commit('application/increaseDialogExtraCount', {count: event.count});\n\t\t\t}\n\n\t\t\tlet body = this.$refs.body;\n\t\t\tif (event.count > 0)\n\t\t\t{\n\t\t\t\tUtils.scrollToElementAfterLoadUnread(this, event.firstMessageId);\n\t\t\t}\n\t\t\telse if (event.error)\n\t\t\t{\n\t\t\t\tlet element = this.$refs.body.getElementsByClassName(DialogReferenceClassName.listUnreadLoader)[0];\n\t\t\t\tif (element)\n\t\t\t\t{\n\t\t\t\t\tUtils.scrollToPosition(this, body.scrollTop - element.offsetHeight*2);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tUtils.scrollToPosition(this, body.scrollHeight - body.clientHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tUtils.scrollToPosition(this, body.scrollHeight - body.clientHeight);\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.waitLoadUnread = false;\n\t\t\t}, 1000);\n\n\t\t\treturn true;\n\t\t},\n\t\treadMessage()\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.readMessageQueue = this.readMessageQueue.filter(messageId =>\n\t\t\t{\n\t\t\t\tif (this.readMessageTarget[messageId])\n\t\t\t\t{\n\t\t\t\t\tif (this.observers[ObserverType.read])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observers[ObserverType.read].unobserve(this.readMessageTarget[messageId]);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.readMessageTarget[messageId];\n\t\t\t\t}\n\t\t\t\tthis.requestReadMessage(messageId);\n\t\t\t\treturn false;\n\t\t\t});\n\t\t},\n\t\trequestReadMessage(messageId)\n\t\t{\n\t\t\tthis.$emit('readMessage', {id: messageId});\n\t\t},\n\n\t\tonClickByUserName(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$emit('clickByUserName', event)\n\t\t},\n\n\t\tonClickByUploadCancel(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$emit('clickByUploadCancel', event)\n\t\t},\n\n\t\tonClickByKeyboardButton(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$emit('clickByKeyboardButton', event)\n\t\t},\n\n\t\tonClickByMessageMenu(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$emit('clickByMessageMenu', event)\n\t\t},\n\n\t\tonClickByMessageRetry(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$emit('clickByMessageRetry', event)\n\t\t},\n\n\t\tonClickByReadedList(event)\n\t\t{\n\t\t\tconst readedList = this.dialog.readedList.filter(record => record.messageId === this.lastMessageId && record.userId !== this.lastMessageAuthorId);\n\t\t\tthis.$emit('clickByReadedList', {list: readedList, event})\n\t\t},\n\n\t\tonMessageReactionSet(event)\n\t\t{\n\t\t\tthis.$emit('setMessageReaction', event)\n\t\t},\n\n\t\tonMessageReactionListOpen(event)\n\t\t{\n\t\t\tthis.$emit('openMessageReactionList', event)\n\t\t},\n\n\t\tonDragMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.captureMove = event.result;\n\n\t\t\tif (!event.result)\n\t\t\t{\n\t\t\t\tthis.capturedMoveEvent = null;\n\t\t\t}\n\t\t},\n\n\t\tonQuoteMessage(event)\n\t\t{\n\t\t\tif (!this.windowFocused)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$emit('quoteMessage', event)\n\t\t},\n\n\t\t_getDateFormat()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tif (this.$root.$bitrixMessages)\n\t\t\t{\n\t\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$root.$bitrixMessages[phrase];\n\t\t\t}\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t\t_groupTitle(date)\n\t\t{\n\t\t\tconst id = Utils.getDateFormat(date);\n\t\t\tif (this.cacheGroupTitle[id])\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tid: id,\n\t\t\t\t\ttitle: this.cacheGroupTitle[id]\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlet dateFormat = MessengerUtils.date.getFormatType(\n\t\t\t\tBX.Messenger.Const.DateFormat.groupTitle,\n\t\t\t\tthis.$root.$bitrixMessages\n\t\t\t);\n\n\t\t\tthis.cacheGroupTitle[id] = this._getDateFormat().format(dateFormat, date);\n\n\t\t\treturn {\n\t\t\t\tid: id,\n\t\t\t\ttitle: this.cacheGroupTitle[id]\n\t\t\t};\n\t\t},\n\n\t\tanimationTrigger(type, start, element)\n\t\t{\n\t\t\tlet templateId = element.dataset.templateId;\n\t\t\tlet templateType = element.dataset.type;\n\t\t\tlet body = this.$refs.body;\n\n\t\t\tif (!body || !templateId)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (start)\n\t\t\t{\n\t\t\t\tif (!this.animationScrollHeightStart)\n\t\t\t\t{\n\t\t\t\t\tthis.animationScrollHeightStart = body.scrollHeight;\n\t\t\t\t\tthis.animationScrollHeightEnd = body.scrollHeight;\n\t\t\t\t\tthis.animationScrollTop = body.scrollTop;\n\t\t\t\t\tthis.animationScrollChange = 0;\n\n\t\t\t\t\tclearTimeout(this.scrollToTimeout);\n\t\t\t\t\tthis.scrollChangedByUser = !(body.scrollTop + this.scrollButtonDiff >= body.scrollHeight - body.clientHeight);\n\n\t\t\t\t\tif (this.scrollChangedByUser && !this.showScrollButton && this.unreadCounter > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showScrollButton = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animationScrollHeightEnd = body.scrollHeight;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!this.collectionMutationType.applied\n\t\t\t\t&& this.collectionMutationType.initialType !== MutationType.set\n\t\t\t)\n\t\t\t{\n\t\t\t\tif (start)\n\t\t\t\t{\n\t\t\t\t\tthis.animationCollection.push(templateId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.animationCollection = this.animationCollection.filter(id => {\n\t\t\t\t\t\tdelete this.animationCollectionOffset[templateId];\n\t\t\t\t\t\treturn id !== templateId;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.animationStart();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!this.collectionMutationType.applied\n\t\t\t\t&& this.collectionMutationType.initialType === MutationType.set\n\t\t\t\t&& this.collectionMutationType.appliedType === MutationType.setBefore\n\t\t\t)\n\t\t\t{\n\t\t\t\tlet unreadId = Utils.getFirstUnreadMessage(this.collection);\n\t\t\t\tif (unreadId)\n\t\t\t\t{\n\t\t\t\t\tUtils.scrollToFirstUnreadMessage(this, this.collection, unreadId, true);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tUtils.scrollToPosition(this, body.scrollHeight - body.clientHeight);\n\n\t\t\t\tif (start)\n\t\t\t\t{\n\t\t\t\t\tthis.animationCollection.push(templateId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.animationCollection = this.animationCollection.filter(id => {\n\t\t\t\t\t\tdelete this.animationCollectionOffset[templateId];\n\t\t\t\t\t\treturn id !== templateId;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.animationStart();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (start)\n\t\t\t{\n\t\t\t\tif (type === AnimationType.leave)\n\t\t\t\t{\n\t\t\t\t\tthis.animationCollectionOffset[templateId] = element.offsetHeight;\n\t\t\t\t}\n\n\t\t\t\tif (this.animationType === AnimationType.none)\n\t\t\t\t{\n\t\t\t\t\tthis.animationType = type;\n\t\t\t\t}\n\t\t\t\telse if (this.animationType !== type)\n\t\t\t\t{\n\t\t\t\t\tthis.animationType = AnimationType.mixed;\n\t\t\t\t}\n\n\t\t\t\tthis.animationCollection.push(templateId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (type === AnimationType.enter)\n\t\t\t\t{\n\t\t\t\t\tlet offset = element.offsetHeight;\n\n\t\t\t\t\tthis.animationScrollChange += offset;\n\t\t\t\t\tbody.scrollTop += offset;\n\t\t\t\t}\n\t\t\t\telse if (type === AnimationType.leave)\n\t\t\t\t{\n\t\t\t\t\tlet offset = this.animationCollectionOffset[templateId]? this.animationCollectionOffset[templateId]: 0;\n\t\t\t\t\tthis.animationScrollChange -= offset;\n\t\t\t\t\tbody.scrollTop -= offset;\n\n\t\t\t\t\tthis.animationScrollLastIsDelimeter = templateType !== TemplateType.message;\n\t\t\t\t}\n\n\t\t\t\tthis.animationCollection = this.animationCollection.filter(id => {\n\t\t\t\t\tdelete this.animationCollectionOffset[templateId];\n\t\t\t\t\treturn id !== templateId;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.animationStart();\n\t\t},\n\n\t\tanimationStart()\n\t\t{\n\t\t\tif (this.animationCollection.length > 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet body = this.$refs.body;\n\n\t\t\tif (this.animationType === AnimationType.leave)\n\t\t\t{\n\t\t\t\tlet newScrollPosition = 0;\n\n\t\t\t\t// fix for chrome dom rendering: while delete node, scroll change immediately\n\t\t\t\tif (body.scrollTop !== this.animationScrollTop + this.animationScrollChange)\n\t\t\t\t{\n\t\t\t\t\tnewScrollPosition = this.animationScrollTop + this.animationScrollChange\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewScrollPosition = body.scrollTop;\n\t\t\t\t}\n\n\t\t\t\t// fix position if last element the same type of new element\n\t\t\t\tif (!this.animationScrollLastIsDelimeter)\n\t\t\t\t{\n\t\t\t\t\tnewScrollPosition += this.templateMessageWithNameDifferent;\n\t\t\t\t}\n\n\t\t\t\tif (newScrollPosition !== body.scrollTop)\n\t\t\t\t{\n\t\t\t\t\tUtils.scrollToPosition(this, newScrollPosition);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.animationType === AnimationType.mixed)\n\t\t\t{\n\t\t\t\tlet unreadId = Utils.getFirstUnreadMessage(this.collection);\n\t\t\t\tif (unreadId)\n\t\t\t\t{\n\t\t\t\t\tUtils.scrollToFirstUnreadMessage(this, this.collection, unreadId, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.animationType = AnimationType.none;\n\t\t\tthis.animationScrollHeightStart = 0;\n\t\t\tthis.animationScrollHeightEnd = 0;\n\t\t\tthis.animationScrollTop = 0;\n\t\t\tthis.animationScrollChange = 0;\n\n\t\t\tif (Utils.scrollByMutationType(this))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.scrollChangedByUser)\n\t\t\t{\n\t\t\t\tconsole.warn('Animation canceled: scroll changed by user');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.unreadCounter > 0 && this.firstUnreadMessageId)\n\t\t\t{\n\t\t\t\tif (this.skipUnreadScroll)\n\t\t\t\t{\n\t\t\t\t\tthis.skipUnreadScroll = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tUtils.scrollToFirstUnreadMessage(this, this.collection, this.firstUnreadMessageId);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.scrollTo(() =>\n\t\t\t{\n\t\t\t\tif (this.unreadCounter <= 0 && this.messageExtraCount)\n\t\t\t\t{\n\t\t\t\t\tthis.$store.commit('application/clearDialogExtraCount');\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\tdirectives:\n\t{\n\t\t'bx-messenger-dialog-observer':\n\t\t{\n\t\t\tinserted(element, bindings, vnode)\n\t\t\t{\n\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!vnode.context.observers[bindings.value])\n\t\t\t\t{\n\t\t\t\t\tvnode.context.observers[bindings.value] = Utils.getMessageLoaderObserver({\n\t\t\t\t\t\ttype: bindings.value,\n\t\t\t\t\t\tcontext: vnode.context\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tvnode.context.observers[bindings.value].observe(element);\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tunbind(element, bindings, vnode)\n\t\t\t{\n\t\t\t\tif (bindings.value === ObserverType.none)\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (vnode.context.observers[bindings.value])\n\t\t\t\t{\n\t\t\t\t\tvnode.context.observers[bindings.value].unobserve(element);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog\" @click=\"onDialogClick\" @touchmove=\"onDialogMove\" ref=\"container\">\t\n\t\t\t<div :class=\"[DialogReferenceClassName.listBody, {\n\t\t\t\t'bx-im-dialog-list-scroll-blocked': scrollBlocked, \n\t\t\t\t'bx-im-dialog-dark-background': isDarkBackground,\n\t\t\t\t'bx-im-dialog-mobile': isMobile,\n\t\t\t}]\" @scroll.passive=\"onScroll\" ref=\"body\">\n\t\t\t\t<template v-if=\"historyLoaderShow\">\n\t\t\t\t\t<div class=\"bx-im-dialog-load-more bx-im-dialog-load-more-history\" v-bx-messenger-dialog-observer=\"ObserverType.history\">\n\t\t\t\t\t\t<span class=\"bx-im-dialog-load-more-text\">{{ localize.IM_MESSENGER_DIALOG_LOAD_MESSAGES }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<transition-group \n\t\t\t\t\ttag=\"div\" class=\"bx-im-dialog-list-box\" name=\"bx-im-dialog-message-animation\" \n\t\t\t\t\t@before-enter=\"animationTrigger(AnimationType.enter, true, $event)\" \n\t\t\t\t\t@after-enter=\"animationTrigger(AnimationType.enter, false, $event)\" \n\t\t\t\t\t@before-leave=\"animationTrigger(AnimationType.leave, true, $event)\" \n\t\t\t\t\t@after-leave=\"animationTrigger(AnimationType.leave, false, $event)\"\n\t\t\t\t>\n\t\t\t\t\t<template v-for=\"element in elementsWithLimit\">\n\t\t\t\t\t\t<template v-if=\"element.templateType == TemplateType.message\">\n\t\t\t\t\t\t\t<div :class=\"['bx-im-dialog-list-item', DialogReferenceClassName.listItem, DialogReferenceClassName.listItem+'-'+element.id]\" :data-message-id=\"element.id\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\" v-bx-messenger-dialog-observer=\"element.unread? ObserverType.read: ObserverType.none\">\t\t\t\n\t\t\t\t\t\t\t\t<component :is=\"element.params.COMPONENT_ID\"\n\t\t\t\t\t\t\t\t\t:userId=\"userId\" \n\t\t\t\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t\t\t\t:dialog=\"dialog\"\n\t\t\t\t\t\t\t\t\t:message=\"element\"\n\t\t\t\t\t\t\t\t\t:enableReactions=\"enableReactions\"\n\t\t\t\t\t\t\t\t\t:enableDateActions=\"enableDateActions\"\n\t\t\t\t\t\t\t\t\t:enableCreateContent=\"showMessageMenu\"\n\t\t\t\t\t\t\t\t\t:enableGestureQuote=\"enableGestureQuote\"\n\t\t\t\t\t\t\t\t\t:enableGestureMenu=\"enableGestureMenu\"\n\t\t\t\t\t\t\t\t\t:showName=\"showMessageUserName\"\n\t\t\t\t\t\t\t\t\t:showAvatar=\"showMessageAvatar\"\n\t\t\t\t\t\t\t\t\t:showMenu=\"showMessageMenu\"\n\t\t\t\t\t\t\t\t\t:capturedMoveEvent=\"capturedMoveEvent\"\n\t\t\t\t\t\t\t\t\t:referenceContentClassName=\"DialogReferenceClassName.listItem\"\n\t\t\t\t\t\t\t\t\t:referenceContentBodyClassName=\"DialogReferenceClassName.listItemBody\"\n\t\t\t\t\t\t\t\t\t:referenceContentNameClassName=\"DialogReferenceClassName.listItemName\"\n\t\t\t\t\t\t\t\t\t@clickByUserName=\"onClickByUserName\"\n\t\t\t\t\t\t\t\t\t@clickByUploadCancel=\"onClickByUploadCancel\"\n\t\t\t\t\t\t\t\t\t@clickByKeyboardButton=\"onClickByKeyboardButton\"\n\t\t\t\t\t\t\t\t\t@clickByMessageMenu=\"onClickByMessageMenu\"\n\t\t\t\t\t\t\t\t\t@clickByMessageRetry=\"onClickByMessageRetry\"\n\t\t\t\t\t\t\t\t\t@setMessageReaction=\"onMessageReactionSet\"\n\t\t\t\t\t\t\t\t\t@openMessageReactionList=\"onMessageReactionListOpen\"\n\t\t\t\t\t\t\t\t\t@dragMessage=\"onDragMessage\"\n\t\t\t\t\t\t\t\t\t@quoteMessage=\"onQuoteMessage\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if=\"element.templateType == TemplateType.group\">\n\t\t\t\t\t\t\t<div class=\"bx-im-dialog-group\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\">\n\t\t\t\t\t\t\t\t<div class=\"bx-im-dialog-group-date\">{{ element.text }}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if=\"element.templateType == TemplateType.delimiter\">\n\t\t\t\t\t\t\t<div class=\"bx-im-dialog-delimiter\" :data-template-id=\"element.templateId\" :data-type=\"element.templateType\" :key=\"element.templateId\"></div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</transition-group>\n\t\t\t\t<template v-if=\"unreadLoaderShow\">\n\t\t\t\t\t<div :class=\"['bx-im-dialog-load-more', 'bx-im-dialog-load-more-unread', DialogReferenceClassName.listUnreadLoader]\" v-bx-messenger-dialog-observer=\"ObserverType.unread\">\n\t\t\t\t\t\t<span class=\"bx-im-dialog-load-more-text\">{{ localize.IM_MESSENGER_DIALOG_LOAD_MESSAGES }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<transition name=\"bx-im-dialog-status\">\n\t\t\t\t\t<template v-if=\"statusWriting\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-status\">\n\t\t\t\t\t\t\t<span class=\"bx-im-dialog-status-writing\"></span>\n\t\t\t\t\t\t\t{{ statusWriting }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"statusReaded\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-status\" @click=\"onClickByReadedList\">\n\t\t\t\t\t\t\t{{ statusReaded }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<transition name=\"bx-im-dialog-scroll-button\">\n\t\t\t\t<div v-show=\"showScrollButton || unreadLoaderShow && unreadCounter\" class=\"bx-im-dialog-scroll-button\" @click=\"scrollToBottom()\">\n\t\t\t\t\t<div v-show=\"unreadCounter\" class=\"bx-im-dialog-scroll-button-counter\">\n\t\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-counter-digit\">{{unreadCounter}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-dialog-scroll-button-arrow\"></div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t`\n});\n\nconst Utils = {\n\tgetDateFormat(date)\n\t{\n\t\treturn date.toJSON().slice(0,10);\n\t},\n\n\tscrollToMessage(context, collection, messageId = 0, force = false, stickToTop = true)\n\t{\n\t\tlet body = context.$refs.body;\n\n\t\tlet element = body.getElementsByClassName(DialogReferenceClassName.listItem+'-'+messageId)[0];\n\n\t\tlet end = 0;\n\t\tif (!element)\n\t\t{\n\t\t\tif (stickToTop)\n\t\t\t{\n\t\t\t\tend = 10;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tend = body.scrollHeight - body.clientHeight;\n\t\t\t}\n\t\t}\n\t\telse if (stickToTop)\n\t\t{\n\t\t\tend = element.offsetTop - (context.templateMessageScrollOffset/2);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tend = element.offsetTop + element.offsetHeight - body.clientHeight + (context.templateMessageScrollOffset/2);\n\t\t}\n\n\t\tif (force)\n\t\t{\n\t\t\tthis.scrollToPosition(context, end);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcontext.scrollTo({end});\n\t\t}\n\n\t\treturn true;\n\t},\n\n\tgetFirstUnreadMessage(collection)\n\t{\n\t\tlet unreadId = null;\n\n\t\tfor (let index = collection.length-1; index >= 0; index--)\n\t\t{\n\t\t\tif (!collection[index].unread)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tunreadId = collection[index].id;\n\t\t}\n\n\t\treturn unreadId;\n\t},\n\n\tscrollToPosition(context, position)\n\t{\n\t\tlet body = context.$refs.body;\n\t\tif (!body)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (context.animateScrollId)\n\t\t{\n\t\t\tAnimation.cancel(context.animateScrollId);\n\t\t\tthis.scrollAnimating = false;\n\t\t\tcontext.animateScrollId = null;\n\t\t}\n\n\t\tbody.scrollTop = position;\n\t},\n\n\tscrollByMutationType(context)\n\t{\n\t\tif (\n\t\t\tcontext.collectionMutationType.applied\n\t\t\t|| context.collectionMutationType.initialType !== MutationType.set)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tcontext.$store.dispatch('messages/applyMutationType', {chatId: context.chatId});\n\n\t\tif (context.collectionMutationType.appliedType === MutationType.setBefore)\n\t\t{\n\t\t\tlet body = context.$refs.body;\n\t\t\tthis.scrollToPosition(context, body.scrollHeight - body.clientHeight);\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif (context.collectionMutationType.scrollMessageId > 0)\n\t\t{\n\t\t\tlet unreadId = Utils.getFirstUnreadMessage(context.collection);\n\t\t\tlet toMessageId = context.collectionMutationType.scrollMessageId;\n\t\t\tlet force = !context.collectionMutationType.scrollStickToTop;\n\t\t\tlet stickToTop = context.collectionMutationType.scrollStickToTop;\n\n\t\t\tif (toMessageId > unreadId)\n\t\t\t{\n\t\t\t\tstickToTop = true;\n\t\t\t\tforce = true;\n\t\t\t\ttoMessageId = unreadId;\n\t\t\t\tunreadId = null;\n\t\t\t}\n\n\t\t\tUtils.scrollToMessage(context, context.collection, toMessageId, force, stickToTop);\n\n\t\t\tif (unreadId)\n\t\t\t{\n\t\t\t\tUtils.scrollToMessage(context, context.collection, unreadId);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tscrollToFirstUnreadMessage(context, collection, unreadId = null, force = false)\n\t{\n\t\tlet body = context.$refs.body;\n\n\t\tlet element = false;\n\t\tif (unreadId !== null)\n\t\t{\n\t\t\telement = body.getElementsByClassName(DialogReferenceClassName.listItem+'-'+unreadId)[0];\n\t\t}\n\t\tif (!element)\n\t\t{\n\t\t\tunreadId = this.getFirstUnreadMessage(collection);\n\t\t}\n\n\t\tthis.scrollToMessage(context, collection, unreadId, force);\n\t},\n\n\tscrollToElementAfterLoadHistory(context, element)\n\t{\n\t\tlet elementBody = element.getElementsByClassName(DialogReferenceClassName.listItemBody)[0];\n\t\tif (elementBody)\n\t\t{\n\t\t\telement = elementBody;\n\t\t}\n\n\t\tlet previousOffsetTop = element.getBoundingClientRect().top;\n\n\t\tcontext.$nextTick(() =>\n\t\t{\n\t\t\tclearTimeout(context.waitLoadHistoryTimeout);\n\t\t\tcontext.waitLoadHistoryTimeout = setTimeout(() => {\n\t\t\t\tcontext.waitLoadHistory = false;\n\t\t\t}, 1000);\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.scrollToPosition(context, element.getBoundingClientRect().top - previousOffsetTop);\n\t\t});\n\t},\n\n\tscrollToElementAfterLoadUnread(context, firstMessageId = 0)\n\t{\n\t\tcontext.showScrollButton = true;\n\n\t\tif (firstMessageId)\n\t\t{\n\t\t\tthis.scrollToMessage(context, context.collection, firstMessageId, false, false);\n\t\t}\n\t},\n\n\tgetMessageLoaderObserver(config)\n\t{\n\t\tif (\n\t\t\ttypeof window.IntersectionObserver === 'undefined'\n\t\t\t|| config.value === ObserverType.none\n\t\t)\n\t\t{\n\t\t\treturn {\n\t\t\t\tobserve: () => {},\n\t\t\t\tunobserve: () => {}\n\t\t\t};\n\t\t}\n\n\t\tlet observerCallback, observerOptions;\n\n\t\tif (config.type === ObserverType.read)\n\t\t{\n\t\t\tobserverCallback = function (entries, observer)\n\t\t\t{\n\t\t\t\tentries.forEach(function(entry)\n\t\t\t\t{\n\t\t\t\t\tlet sendReadEvent = false;\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (entry.intersectionRatio >= 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (\n\t\t\t\t\t\t\tentry.intersectionRatio > 0\n\t\t\t\t\t\t\t&& entry.rootBounds.height < entry.boundingClientRect.height + 20\n\t\t\t\t\t\t\t&& entry.intersectionRect.height > entry.rootBounds.height - 20\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsendReadEvent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sendReadEvent)\n\t\t\t\t\t{\n\t\t\t\t\t\tconfig.context.readMessageQueue.push(entry.target.dataset.messageId);\n\t\t\t\t\t\tconfig.context.readMessageTarget[entry.target.dataset.messageId] = entry.target;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconfig.context.readMessageQueue = config.context.readMessageQueue.filter(messageId => messageId !== entry.target.dataset.messageId);\n\t\t\t\t\t\tdelete config.context.readMessageTarget[entry.target.dataset.messageId];\n\t\t\t\t\t}\n\n\t\t\t\t\tconfig.context.readMessageDelayed();\n\t\t\t\t});\n\t\t\t};\n\t\t\tobserverOptions = {\n\t\t\t\troot: config.context.$refs.body,\n\t\t\t\tthreshold: new Array(101).fill(0).map((zero, index) => index * 0.01)\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tobserverCallback = function (entries, observer)\n\t\t\t{\n\t\t\t\tentries.forEach(function(entry)\n\t\t\t\t{\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (config.type === ObserverType.unread)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconfig.context.requestUnreadBlockIntersect = true;\n\t\t\t\t\t\t\tconfig.context.requestUnreadDelayed();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconfig.context.requestHistoryBlockIntersect = true;\n\t\t\t\t\t\t\tconfig.context.requestHistoryDelayed();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (config.type === ObserverType.unread)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconfig.context.requestUnreadBlockIntersect = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconfig.context.requestHistoryBlockIntersect = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tobserverOptions = {\n\t\t\t\troot: config.context.$refs.body,\n\t\t\t\tthreshold: [0, 0.01, 0.99, 1]\n\t\t\t};\n\t\t}\n\n\t\treturn new IntersectionObserver(observerCallback, observerOptions);\n\t}\n};\n\nconst Blocks = {\n\tgetDelimiter(id = 0)\n\t{\n\t\treturn {\n\t\t\ttemplateId: 'delimiter'+id,\n\t\t\ttemplateType: TemplateType.delimiter\n\t\t};\n\t},\n\tgetGroup(id = 0, text = '')\n\t{\n\t\treturn {\n\t\t\ttemplateId: 'group'+id,\n\t\t\ttemplateType: TemplateType.group,\n\t\t\ttext: text\n\t\t};\n\t},\n\tgetHistoryLoader()\n\t{\n\t\treturn {\n\t\t\ttemplateId: 'historyLoader',\n\t\t\ttemplateType: TemplateType.historyLoader,\n\t\t};\n\t},\n\tgetUnreadLoader()\n\t{\n\t\treturn {\n\t\t\ttemplateId: 'unreadLoader',\n\t\t\ttemplateType: TemplateType.unreadLoader,\n\t\t};\n\t},\n\tgetLoadButton(id = 0, text = '', type = LoadButtonTypes.before)\n\t{\n\t\treturn {\n\t\t\ttemplateId: 'loadButton'+id+type,\n\t\t\ttemplateType: TemplateType.button,\n\t\t\ttext: text,\n\t\t\ttype: type,\n\t\t\tmessageId: id\n\t\t};\n\t}\n};\n"],"names":["TemplateType","Object","freeze","message","delimiter","group","historyLoader","unreadLoader","button","ObserverType","history","unread","read","none","LoadButtonTypes","before","after","AnimationType","mixed","enter","leave","Vue","component","props","userId","default","dialogId","chatId","messageLimit","messageExtraCount","listenEventScrollToBottom","listenEventRequestHistory","listenEventRequestUnread","enableReactions","enableDateActions","enableCreateContent","enableGestureQuote","enableGestureMenu","showMessageUserName","showMessageAvatar","showMessageMenu","data","scrollAnimating","showScrollButton","messageShowCount","unreadLoaderShow","historyLoaderBlocked","historyLoaderShow","startMessageLimit","templateMessageScrollOffset","templateMessageWithNameDifferent","DialogReferenceClassName","captureMove","capturedMoveEvent","lastMessageId","created","unreadCounter","scrollChangedByUser","scrollButtonDiff","scrollButtonShowTimeout","scrollPosition","scrollPositionChangeTime","Date","getTime","animationScrollHeightStart","animationScrollHeightEnd","animationScrollTop","animationScrollChange","animationScrollLastUserId","animationType","animationCollection","animationCollectionOffset","animationLastElementBeforeStart","observers","requestHistoryInterval","requestUnreadInterval","lastAuthorId","firstMessageId","firstUnreadMessageId","dateFormatFunction","cacheGroupTitle","waitLoadHistory","waitLoadUnread","skipUnreadScroll","readMessageQueue","readMessageTarget","readMessageDelayed","MessengerUtils","debounce","readMessage","requestHistoryBlockIntersect","requestHistoryDelayed","requestHistory","requestUnreadBlockIntersect","requestUnreadDelayed","requestUnread","event","$on","onScrollToBottom","$root","onRequestHistoryAnswer","onRequestUnreadAnswer","window","addEventListener","onOrientationChange","onWindowFocus","onWindowBlur","beforeDestroy","clearTimeout","clearInterval","$off","removeEventListener","mounted","unreadId","Utils","getFirstUnreadMessage","collection","scrollToFirstUnreadMessage","body","$refs","scrollToPosition","scrollHeight","clientHeight","windowFocused","platform","isBitrixMobile","document","hasFocus","computed","localize","getFilteredPhrases","$bitrixMessages","dialog","$store","getters","collectionMutationType","elementsWithLimit","unreadCount","filter","element","length","showLimit","start","groupNode","slicedCollection","slice","id","lastMessageAuthorId","authorId","forEach","_groupTitle","date","title","push","Blocks","getGroup","getDelimiter","unreadLastId","statusWriting","scrollToTimeout","writingList","setTimeout","scrollTo","duration","IM_MESSENGER_DIALOG_WRITES_MESSAGE","replace","map","userName","join","statusReaded","readedList","text","type","DialogType","private","record","messageId","dateFormat","getFormatType","BX","Messenger","Const","DateFormat","readedTitle","IM_MESSENGER_DIALOG_MESSAGES_READED_USER","_getDateFormat","format","IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT","IM_MESSENGER_DIALOG_MESSAGES_READED_CHAT_PLURAL","counter","scrollBlocked","application","device","DeviceType","mobile","isDarkBackground","options","darkBackground","isMobile","Vuex","mapState","state","methods","onDialogClick","testNode","target","className","onCommandClick","onMentionClick","$emit","onDialogMove","value","dataset","entity","nextSibling","innerHTML","command","onScroll","scrollTop","offsetHeight","scrollToBottom","params","force","cancelIfScrollChange","scrollToMessageId","commit","scrollParams","callback","animateScrollId","Animation","cancel","end","increment","container","console","warn","elementProperty","log","waitLoadHistoryTimeout","getElementsByClassName","listItem","count","scrollToElementAfterLoadHistory","lastId","error","scrollIntoView","scrollToElementAfterLoadUnread","listUnreadLoader","unobserve","requestReadMessage","onClickByUserName","onClickByUploadCancel","onClickByKeyboardButton","onClickByMessageMenu","onClickByMessageRetry","onClickByReadedList","list","onMessageReactionSet","onMessageReactionListOpen","onDragMessage","result","onQuoteMessage","create","Main","_getMessage","phrase","getDateFormat","groupTitle","animationTrigger","templateId","templateType","applied","initialType","MutationType","set","animationStart","appliedType","setBefore","offset","animationScrollLastIsDelimeter","newScrollPosition","scrollByMutationType","directives","inserted","bindings","vnode","context","getMessageLoaderObserver","observe","unbind","template","toJSON","scrollToMessage","stickToTop","offsetTop","index","position","dispatch","scrollMessageId","toMessageId","scrollStickToTop","elementBody","listItemBody","previousOffsetTop","getBoundingClientRect","top","$nextTick","config","IntersectionObserver","observerCallback","observerOptions","entries","observer","entry","sendReadEvent","isIntersecting","intersectionRatio","rootBounds","height","boundingClientRect","intersectionRect","root","threshold","Array","fill","zero","getHistoryLoader","getUnreadLoader","getLoadButton"],"mappings":"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"}
(function(t,e,s,a,n,i,o,r,l){"use strict";var m=window.BX;var c=Object.freeze({default:"default",progress:"progress",image:"image",audio:"audio",video:"video",richLink:"richLink"});i.Vue.component("bx-messenger-message-body",{props:{userId:{default:0},dialogId:{default:"0"},chatId:{default:0},messageType:{default:r.MessageType.self},message:{type:Object,default:o.MessagesModel.create().getElementState},user:{type:Object,default:o.UsersModel.create().getElementState},dialog:{type:Object,default:o.DialoguesModel.create().getElementState},files:{type:Object,default:{}},enableReactions:{default:true},showName:{default:true},showAvatar:{default:true},referenceContentBodyClassName:{default:""},referenceContentNameClassName:{default:""}},created:function t(){this.dateFormatFunction=null;this.cacheFormatDate={}},methods:{clickByUserName:function t(e){this.$emit("clickByUserName",e)},clickByUploadCancel:function t(e){this.$emit("clickByUploadCancel",e)},clickByKeyboardButton:function t(e){this.$emit("clickByKeyboardButton",babelHelpers.objectSpread({message:e.message},e.event))},setReaction:function t(e){this.$emit("setReaction",e)},openReactionList:function t(e){this.$emit("openReactionList",e)},formatDate:function t(e){var s=e.toJSON().slice(0,10);if(this.cacheFormatDate[s]){return this.cacheFormatDate[s]}var a=l.Utils.date.getFormatType(m.Messenger.Const.DateFormat.message,this.$root.$bitrixMessages);this.cacheFormatDate[s]=this._getDateFormat().format(a,e);return this.cacheFormatDate[s]},_getDateFormat:function t(){var e=this;if(this.dateFormatFunction){return this.dateFormatFunction}this.dateFormatFunction=Object.create(m.Main.Date);if(this.$root.$bitrixMessages){this.dateFormatFunction._getMessage=function(t){return e.$root.$bitrixMessages[t]}}return this.dateFormatFunction}},computed:{MessageType:function t(){return r.MessageType},ContentType:function t(){return c},contentType:function t(){if(this.filesData.length>0){var e=false;var s=false;var a=false;var n=false;var i=true;var o=false;var r=undefined;try{for(var l=this.filesData[Symbol.iterator](),m;!(i=(m=l.next()).done);i=true){var f=m.value;if(f.progress<0){n=true;break}else if(f.type==="audio"){if(s||e){e=false;s=false;break}a=true}else if(f.type==="image"&&f.image){if(s||a){a=false;s=false;break}e=true}else if(f.type==="video"){if(e||a){a=false;e=false;break}s=true}else{a=false;e=false;s=false;break}}}catch(t){o=true;r=t}finally{try{if(!i&&l.return!=null){l.return()}}finally{if(o){throw r}}}if(n){return c.progress}else if(e){return c.image}else if(a){return c.audio}else if(s){return c.video}}return c.default},localize:function t(){return i.Vue.getFilteredPhrases("IM_MESSENGER_MESSAGE_",this.$root.$bitrixMessages)},formattedDate:function t(){return this.formatDate(this.message.date)},messageText:function t(){if(this.isDeleted){return this.localize.IM_MESSENGER_MESSAGE_DELETED}return this.message.textConverted},messageAttach:function t(){return this.message.params.ATTACH},messageReactions:function t(){return this.message.params.REACTION||{}},isEdited:function t(){return this.message.params.IS_EDITED==="Y"},isDeleted:function t(){return this.message.params.IS_DELETED==="Y"},chatColor:function t(){return this.dialog.type!==r.DialogType.private?this.user.color:this.dialog.color},filesData:function t(){var e=this;var s=[];if(!this.message.params.FILE_ID||this.message.params.FILE_ID.length<=0){return s}this.message.params.FILE_ID.forEach(function(t){if(!t){return false}var a=e.$store.getters["files/get"](e.chatId,t,true);if(!a){e.$store.commit("files/set",{data:[e.$store.getters["files/getBlank"]({id:t,chatId:e.chatId})]});a=e.$store.getters["files/get"](e.chatId,t,true)}if(a){s.push(a)}});return s},keyboardButtons:function t(){var e=false;if(!this.message.params.KEYBOARD||this.message.params.KEYBOARD==="N"){return e}return this.message.params.KEYBOARD}},template:'\n\t\t<div class="bx-im-message-content-wrap">\n\t\t\t<template v-if="contentType == ContentType.default || contentType == ContentType.audio || contentType == ContentType.progress">\n\t\t\t\t<div class="bx-im-message-content">\n\t\t\t\t\t<span class="bx-im-message-content-box">\n\t\t\t\t\t\t<template v-if="showName && messageType == MessageType.opponent">\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-name\', referenceContentNameClassName]" :style="{color: user.color}" @click="clickByUserName({user: user, event: $event})">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body\', referenceContentBodyClassName]">\n\t\t\t\t\t\t\t<template v-if="contentType == ContentType.audio">\n\t\t\t\t\t\t\t\t<bx-messenger-element-file-audio v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<bx-messenger-element-file v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body-wrap\', {\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-with-text\': messageText.length > 0,\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-without-text\': messageText.length <= 0,\n\t\t\t\t\t\t\t}]">\n\t\t\t\t\t\t\t\t<template v-if="messageText">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-text" v-html="messageText"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-for="(config, id) in messageAttach">\n\t\t\t\t\t\t\t\t\t<bx-messenger-element-attach :config="config" :baseColor="user.color" :key="id"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class="bx-im-message-content-params">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-date">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if="enableReactions && message.authorId" class="bx-im-message-content-reaction">\n\t\t\t\t\t\t<bx-reaction :values="messageReactions" :userId="userId" :openList="false" @set="setReaction({message: message, reaction: $event})" @list="openReactionList({message: message, values: $event.values})"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else-if="contentType == ContentType.richLink">\n\t\t\t\t\x3c!-- richLink type markup --\x3e\n\t\t\t</template>\n\t\t\t<template v-else-if="contentType == ContentType.image || contentType == ContentType.video">\n\t\t\t\t<div class="bx-im-message-content bx-im-message-content-fit">\n\t\t\t\t\t<span class="bx-im-message-content-box">\n\t\t\t\t\t\t<template v-if="showName && messageType == MessageType.opponent">\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-name\', referenceContentNameClassName]" :style="{color: user.color}" @click="clickByUserName({user: user, event: $event})">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body\', referenceContentBodyClassName]">\n\t\t\t\t\t\t\t<template v-if="contentType == ContentType.image">\n\t\t\t\t\t\t\t\t<bx-messenger-element-file-image v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if="contentType == ContentType.video">\n\t\t\t\t\t\t\t\t<bx-messenger-element-file-video v-for="file in filesData" :messageType="messageType" :file="file" :key="file.templateId" @uploadCancel="clickByUploadCancel"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class="[\'bx-im-message-content-body-wrap\', {\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-with-text\': messageText.length > 0,\n\t\t\t\t\t\t\t\t\'bx-im-message-content-body-without-text\': messageText.length <= 0,\n\t\t\t\t\t\t\t}]">\n\t\t\t\t\t\t\t\t<template v-if="messageText">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-text" v-html="messageText"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class="bx-im-message-content-params">\n\t\t\t\t\t\t\t\t\t<span class="bx-im-message-content-date">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if="enableReactions && message.authorId" class="bx-im-message-content-reaction">\n\t\t\t\t\t\t<bx-reaction :values="messageReactions" :userId="userId" :openList="false" @set="setReaction({message: message, reaction: $event})" @list="openReactionList({message: message, values: $event.values})"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="keyboardButtons">\n\t\t\t\t<bx-messenger-element-keyboard :buttons="keyboardButtons" :messageId="message.id" :userId="userId" :dialogId="dialogId" @click="clickByKeyboardButton({message: message, event: $event})"/>\n\t\t\t</template>\n\t\t</div>\n\t'})})(this.window=this.window||{},window,window,window,window,BX,BX.Messenger.Model,BX.Messenger.Const,BX.Messenger);
//# sourceMappingURL=body.bundle.map.js
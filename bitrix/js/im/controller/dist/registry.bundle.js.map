{"version":3,"file":"registry.bundle.js","sources":["../src/application.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Application controller\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {Timer} from 'im.tools.timer';\nimport {RestMethod} from \"im.const\";\nimport {Utils} from \"im.utils\";\n\nclass ApplicationController\n{\n\tconstructor()\n\t{\n\t\tthis.store = null;\n\t\tthis.restClient = null;\n\t\tthis.templateEngine = null;\n\n\t\tthis.timer = new Timer();\n\n\t\tthis._prepareFilesBeforeSave = params => { return params };\n\n\t\tthis.defaultMessageLimit = 20;\n\t\tthis.requestMessageLimit = this.getDefaultMessageLimit();\n\n\t\tthis.messageLastReadId = {};\n\t\tthis.messageReadQueue = {};\n\t}\n\n\tsetTemplateEngine(template)\n\t{\n\t\tthis.templateEngine = template;\n\t}\n\n\tsetRestClient(client)\n\t{\n\t\tthis.restClient = client;\n\t}\n\n\tsetStore(store)\n\t{\n\t\tthis.store = store;\n\t}\n\n\tgetSiteId()\n\t{\n\t\treturn this.store.state.application.common.siteId;\n\t}\n\n\tgetUserId()\n\t{\n\t\treturn this.store.state.application.common.userId;\n\t}\n\n\tgetLanguageId()\n\t{\n\t\treturn this.store.state.application.common.languageId;\n\t}\n\n\tgetCurrentUser()\n\t{\n\t\treturn this.store.getters['users/get'](this.store.state.application.common.userId, true);\n\t}\n\n\tgetChatId()\n\t{\n\t\treturn this.store.state.application.dialog.chatId;\n\t}\n\n\tgetDialogId()\n\t{\n\t\treturn this.store.state.application.dialog.dialogId;\n\t}\n\n\tgetDialogData(dialogId = this.getDialogId())\n\t{\n\t\treturn this.store.state.dialogues.collection[dialogId];\n\t}\n\n\tgetDialogIdByChatId(chatId)\n\t{\n\t\tif (this.getDialogId() === 'chat'+chatId)\n\t\t{\n\t\t\treturn this.getDialogId();\n\t\t}\n\n\t\tlet dialog = this.store.getters['dialogues/getByChatId'](chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn dialog.dialogId;\n\t}\n\n\tgetDiskFolderId()\n\t{\n\t\treturn this.store.state.application.dialog.diskFolderId;\n\t}\n\n\tgetMessageLimit()\n\t{\n\t\treturn this.store.state.application.dialog.messageLimit;\n\t}\n\n\tgetDefaultMessageLimit()\n\t{\n\t\treturn this.defaultMessageLimit;\n\t}\n\n\tgetRequestMessageLimit()\n\t{\n\t\treturn this.requestMessageLimit;\n\t}\n\n\temit(eventName, params = {})\n\t{\n\t\tthis.templateEngine.$emit(eventName, params);\n\n\t\treturn true;\n\t}\n\n\tlisten(eventName, callback)\n\t{\n\t\tif (typeof callback !== 'function')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.templateEngine.$on(eventName, callback);\n\n\t\treturn true;\n\t}\n\n\tgetReadedList()\n\t{\n\t\tlet dialog = this.store.state.dialogues.collection[this.getDialogId()];\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn dialog.readedList;\n\t}\n\n\n\tisUnreadMessagesLoaded()\n\t{\n\t\tlet dialog = this.store.state.dialogues.collection[this.getDialogId()];\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (dialog.unreadLastId <= 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tlet collection = this.store.state.messages.collection[this.getChatId()];\n\t\tif (!collection || collection.length <= 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tlet lastElementId = 0;\n\t\tfor (let index = collection.length-1; index >= 0; index--)\n\t\t{\n\t\t\tlet lastElement = collection[index];\n\t\t\tif (typeof lastElement.id === \"number\")\n\t\t\t{\n\t\t\t\tlastElementId = lastElement.id;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn lastElementId >= dialog.unreadLastId;\n\t}\n\n\tprepareFilesBeforeSave(files)\n\t{\n\t\treturn this._prepareFilesBeforeSave(files);\n\t}\n\n\tsetPrepareFilesBeforeSaveFunction(func)\n\t{\n\t\tthis._prepareFilesBeforeSave = func.bind(this);\n\t}\n\n\tstartOpponentWriting(params)\n\t{\n\t\tlet {dialogId, userId, userName} = params;\n\n\t\tthis.store.dispatch('dialogues/updateWriting', {\n\t\t\tdialogId,\n\t\t\tuserId,\n\t\t\tuserName,\n\t\t\taction : true\n\t\t});\n\n\t\tthis.timer.start('writingEnd', dialogId+'|'+userId, 35, (id, params) => {\n\t\t\tlet {dialogId, userId} = params;\n\t\t\tthis.store.dispatch('dialogues/updateWriting', {\n\t\t\t\tdialogId,\n\t\t\t\tuserId,\n\t\t\t\taction: false\n\t\t\t});\n\t\t}, {dialogId, userId});\n\n\t\treturn true;\n\t}\n\n\tstopOpponentWriting(params = {})\n\t{\n\t\tlet {dialogId, userId, userName} = params;\n\n\t\tthis.timer.stop('writingStart', dialogId+'|'+userId, true);\n\t\tthis.timer.stop('writingEnd', dialogId+'|'+userId);\n\n\t\treturn true;\n\t}\n\n\tstartWriting(dialogId = this.getDialogId())\n\t{\n\t\tif (Utils.dialog.isEmptyDialogId(dialogId) || this.timer.has('writes', dialogId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.timer.start('writes', dialogId, 28);\n\t\tthis.timer.start('writesSend', dialogId, 5, (id) => {\n\t\t\tthis.restClient.callMethod(RestMethod.imDialogWriting, {\n\t\t\t\t'DIALOG_ID': dialogId\n\t\t\t}).catch(() => {\n\t\t\t\tthis.timer.stop('writes', dialogId);\n\t\t\t});\n\t\t});\n\t}\n\n\tstopWriting(dialogId = this.getDialogId())\n\t{\n\t\tthis.timer.stop('writes', dialogId, true);\n\t\tthis.timer.stop('writesSend', dialogId, true);\n\t}\n\n\tsetTextareaMessage(params)\n\t{\n\t\tlet {\n\t\t\tmessage = '',\n\t\t\tdialogId = this.getDialogId()\n\t\t} = params;\n\n\t\tthis.store.dispatch('dialogues/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\ttextareaMessage: message\n\t\t\t},\n\t\t});\n\t}\n\n\tsetSendingMessageFlag(messageId)\n\t{\n\t\tthis.store.dispatch('messages/actionStart', {\n\t\t\tid: messageId,\n\t\t\tchatId: this.getChatId()\n\t\t});\n\t}\n\n\treactMessage(messageId, type = 'like', action = 'auto')\n\t{\n\t\tthis.restClient.callMethod(RestMethod.imMessageLike, {\n\t\t\t'MESSAGE_ID': messageId,\n\t\t\t'ACTION': action === 'auto'? 'auto': (action === 'set'? 'plus': 'minus')\n\t\t});\n\t}\n\n\treadMessage(messageId = null, force = false, skipAjax = false)\n\t{\n\t\tlet chatId = this.getChatId();\n\n\t\tif (typeof this.messageLastReadId[chatId] === 'undefined')\n\t\t{\n\t\t\tthis.messageLastReadId[chatId] = null;\n\t\t}\n\t\tif (typeof this.messageReadQueue[chatId] === 'undefined')\n\t\t{\n\t\t\tthis.messageReadQueue[chatId] = [];\n\t\t}\n\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.messageReadQueue[chatId].push(parseInt(messageId));\n\t\t}\n\n\t\tthis.timer.stop('readMessage', chatId, true);\n\t\tthis.timer.stop('readMessageServer', chatId, true);\n\n\t\tif (force)\n\t\t{\n\t\t\treturn this.readMessageExecute(chatId, skipAjax);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.timer.start('readMessage', chatId, .1, (chatId, params) => this.readMessageExecute(chatId, skipAjax).then((result) => resolve(result)));\n\t\t});\n\t}\n\n\treadMessageExecute(chatId, skipAjax = false)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.messageReadQueue[chatId])\n\t\t\t{\n\t\t\t\tthis.messageReadQueue[chatId] = this.messageReadQueue[chatId].filter(elementId => {\n\t\t\t\t\tif (!this.messageLastReadId[chatId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.messageLastReadId[chatId] = elementId;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.messageLastReadId[chatId] < elementId)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.messageLastReadId[chatId] = elementId;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet dialogId = this.getDialogIdByChatId(chatId);\n\t\t\tlet lastId = this.messageLastReadId[chatId] || 0;\n\t\t\tif (lastId <= 0)\n\t\t\t{\n\t\t\t\tresolve({dialogId, lastId: 0});\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\t\tchatId: chatId,\n\t\t\t\treadId: lastId\n\t\t\t}).then(result =>\n\t\t\t{\n\t\t\t\tthis.store.dispatch('dialogues/decreaseCounter', {\n\t\t\t\t\tdialogId,\n\t\t\t\t\tcount: result.count\n\t\t\t\t});\n\n\t\t\t\tif (this.getChatId() === chatId && this.store.getters['dialogues/canSaveChat'])\n\t\t\t\t{\n\t\t\t\t\tlet dialog = this.store.getters['dialogues/get'](dialogId);\n\t\t\t\t\tif (dialog.counter <= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.store.commit('application/clearDialogExtraCount');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (skipAjax)\n\t\t\t\t{\n\t\t\t\t\tresolve({dialogId, lastId});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.timer.start('readMessageServer', chatId, .5, () => {\n\t\t\t\t\t\tthis.restClient.callMethod(RestMethod.imDialogRead, {\n\t\t\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t\t\t'MESSAGE_ID': lastId\n\t\t\t\t\t\t}).then(() => resolve({dialogId, lastId})).catch(() => resolve({dialogId, lastId}));\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t}).catch(() => {\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\t}\n\n\tunreadMessage(messageId = null, skipAjax = false)\n\t{\n\t\tlet chatId = this.getChatId();\n\n\t\tif (typeof this.messageLastReadId[chatId] === 'undefined')\n\t\t{\n\t\t\tthis.messageLastReadId[chatId] = null;\n\t\t}\n\t\tif (typeof this.messageReadQueue[chatId] === 'undefined')\n\t\t{\n\t\t\tthis.messageReadQueue[chatId] = [];\n\t\t}\n\n\t\tif (messageId)\n\t\t{\n\t\t\tthis.messageReadQueue[chatId] = this.messageReadQueue[chatId].filter(id => id < messageId);\n\t\t}\n\n\t\tthis.timer.stop('readMessage', chatId, true);\n\t\tthis.timer.stop('readMessageServer', chatId, true);\n\n\t\tthis.messageLastReadId[chatId] = messageId;\n\n\t\tthis.store.dispatch('messages/unreadMessages', {\n\t\t\tchatId: chatId,\n\t\t\tunreadId: this.messageLastReadId[chatId]\n\t\t}).then(result => {\n\n\t\t\tlet dialogId = this.getDialogIdByChatId(chatId);\n\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tunreadId: messageId\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.store.dispatch('dialogues/increaseCounter', {\n\t\t\t\tdialogId,\n\t\t\t\tcount: result.count\n\t\t\t});\n\n\t\t\tif (!skipAjax)\n\t\t\t{\n\t\t\t\tthis.restClient.callMethod(RestMethod.imDialogUnread, {\n\t\t\t\t\t'DIALOG_ID': dialogId,\n\t\t\t\t\t'MESSAGE_ID': this.messageLastReadId[chatId]\n\t\t\t\t});\n\t\t\t}\n\n\t\t}).catch(() => {});\n\t}\n\n\tshareMessage(messageId, type, date = null)\n\t{\n\t\tthis.restClient.callMethod(RestMethod.imMessageShare, {\n\t\t\t'DIALOG_ID': this.getDialogId(),\n\t\t\t'MESSAGE_ID': messageId,\n\t\t\t'TYPE': type,\n\t\t});\n\n\t\treturn true;\n\t}\n}\n\nexport {ApplicationController};"],"names":["ApplicationController","store","restClient","templateEngine","timer","Timer","_prepareFilesBeforeSave","params","defaultMessageLimit","requestMessageLimit","getDefaultMessageLimit","messageLastReadId","messageReadQueue","template","client","state","application","common","siteId","userId","languageId","getters","dialog","chatId","dialogId","getDialogId","dialogues","collection","diskFolderId","messageLimit","eventName","$emit","callback","$on","readedList","unreadLastId","messages","getChatId","length","lastElementId","index","lastElement","id","files","func","bind","userName","dispatch","action","start","stop","Utils","isEmptyDialogId","has","callMethod","RestMethod","imDialogWriting","catch","message","fields","textareaMessage","messageId","imMessageLike","force","skipAjax","push","parseInt","readMessageExecute","Promise","resolve","reject","then","result","filter","elementId","getDialogIdByChatId","lastId","readId","count","counter","commit","imDialogRead","unreadId","imDialogUnread","type","imMessageShare"],"mappings":"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"}
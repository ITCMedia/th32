{"version":3,"file":"registry.bundle.js","sources":["../src/im.command.handler.js","../src/registry.js"],"sourcesContent":["/**\n * Bitrix Messenger\n * Im pull commands (Pull Command Handler)\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {PullClient} from \"pull.client\";\nimport {VuexBuilderModel} from 'ui.vue.vuex';\nimport {EventType} from \"im.const\";\n\nclass ImPullCommandHandler\n{\n\tstatic create(params = {})\n\t{\n\t\treturn new this(params);\n\t}\n\n\tconstructor(params = {})\n\t{\n\t\tif (typeof params.controller === 'object' && params.controller)\n\t\t{\n\t\t\tthis.controller = params.controller;\n\t\t}\n\t\tif (typeof params.store === 'object' && params.store)\n\t\t{\n\t\t\tthis.store = params.store;\n\t\t}\n\n\t\tthis.option = typeof params.store === 'object' && params.store? params.store: {};\n\n\t\tif (\n\t\t\t!(\n\t\t\t\ttypeof this.option.handlingDialog === 'object'\n\t\t\t\t&& this.option.handlingDialog\n\t\t\t\t&& this.option.handlingDialog.chatId\n\t\t\t\t&& this.option.handlingDialog.dialogId\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tthis.option.handlingDialog = false;\n\t\t}\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType()\n\t{\n\t\treturn PullClient.SubscriptionType.Server;\n\t}\n\n\tskipExecute(params, extra)\n\t{\n\t\tif (this.option.skip)\n\t\t{\n\t\t\tconsole.info('Pull: command skipped while loading messages', params);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!this.option.handlingDialog)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof params.chatId !== 'undefined' || typeof params.dialogId !== 'undefined' )\n\t\t{\n\t\t\tif (\n\t\t\t\ttypeof params.chatId !== 'undefined'\n\t\t\t\t&& parseInt(params.chatId) === parseInt(this.option.handlingDialog.chatId)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof params.dialogId !== 'undefined'\n\t\t\t\t&& params.dialogId.toString() === this.option.handlingDialog.dialogId.toString()\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.chat && params.chat[params.chatId])\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: params.chat[params.chatId]\n\t\t\t});\n\t\t}\n\n\t\tif (params.users)\n\t\t{\n\t\t\tthis.store.dispatch('users/set', VuexBuilderModel.convertToArray(params.users));\n\t\t}\n\n\t\tif (params.files)\n\t\t{\n\t\t\tlet files = VuexBuilderModel.convertToArray(params.files);\n\t\t\tfiles.forEach(file =>\n\t\t\t{\n\t\t\t\tfile = this.controller.prepareFilesBeforeSave(file);\n\t\t\t\tif (\n\t\t\t\t\tfiles.length === 1\n\t\t\t\t\t&& params.message.templateFileId\n\t\t\t\t\t&& this.store.state.files.index[params.chatId]\n\t\t\t\t\t&& this.store.state.files.index[params.chatId][params.message.templateFileId]\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/update', {\n\t\t\t\t\t\tid: params.message.templateFileId,\n\t\t\t\t\t\tchatId: params.chatId,\n\t\t\t\t\t\tfields: file\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.store.dispatch('files/set', file);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet collection = this.store.state.messages.collection[params.chatId];\n\t\tif (!collection)\n\t\t{\n\t\t\tcollection = [];\n\t\t}\n\n\t\tlet update = false;\n\t\tif (params.message.templateId && collection.length > 0)\n\t\t{\n\t\t\tfor (let index = collection.length-1; index >= 0; index--)\n\t\t\t{\n\t\t\t\tif (collection[index].id === params.message.templateId)\n\t\t\t\t{\n\t\t\t\t\tupdate = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (update)\n\t\t{\n\t\t\tthis.store.dispatch('messages/update', {\n\t\t\t\tid: params.message.templateId,\n\t\t\t\tchatId: params.chatId,\n\t\t\t\tfields: {\n\t\t\t\t\t...params.message,\n\t\t\t\t\tsending: false,\n\t\t\t\t\terror: false,\n\t\t\t\t}\n\t\t\t}).then(() => {\n\t\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: params.message.senderId !== this.controller.getUserId()});\n\t\t\t});\n\t\t}\n\t\telse if (this.controller.isUnreadMessagesLoaded())\n\t\t{\n\t\t\tif (this.controller.getChatId() === params.chatId)\n\t\t\t{\n\t\t\t\tthis.store.commit('application/increaseDialogExtraCount');\n\t\t\t}\n\n\t\t\tthis.store.dispatch('messages/setAfter', {...params.message, unread: true});\n\t\t}\n\n\t\tthis.controller.stopOpponentWriting({\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.message.senderId\n\t\t});\n\n\t\tif (params.message.senderId === this.controller.getUserId())\n\t\t{\n\t\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\t\tchatId: params.chatId\n\t\t\t}).then(result => {\n\t\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\t\tdialogId: params.dialogId,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.store.dispatch('dialogues/increaseCounter', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tcount: 1,\n\t\t\t});\n\t\t}\n\t}\n\n\thandleMessageUpdate(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\thandleMessageDelete(params, extra, command)\n\t{\n\t\tthis.execMessageUpdateOrDelete(params, extra, command);\n\t}\n\n\texecMessageUpdateOrDelete(params, extra, command)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.stopOpponentWriting({\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId\n\t\t});\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {\n\t\t\t\ttext: command === \"messageUpdate\"? params.text: '',\n\t\t\t\ttextOriginal: command === \"messageUpdate\"? params.textOriginal: '',\n\t\t\t\tparams: params.params,\n\t\t\t\tblink: true\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t});\n\n\t\tthis.controller.stopOpponentWriting({\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.senderId,\n\t\t\taction: false\n\t\t});\n\t}\n\n\thandleMessageLike(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: {LIKE: params.users}}\n\t\t});\n\t}\n\n\thandleMessageParamsUpdate(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: {params: params.params}\n\t\t}).then(() => {\n\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n\n\thandleStartWriting(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.controller.startOpponentWriting(params);\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\treadId: params.lastId\n\t\t}).then(result => {\n\t\t\tthis.store.dispatch('dialogues/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleReadMessageOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\thandleReadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execReadMessageOpponent(params, extra);\n\t}\n\n\texecReadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/updateReaded', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\tuserName: params.userName,\n\t\t\tmessageId: params.lastId,\n\t\t\tdate: params.date,\n\t\t\taction: true\n\t\t});\n\t}\n\n\thandleUnreadMessageOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\thandleUnreadMessageChatOpponent(params, extra)\n\t{\n\t\tthis.execUnreadMessageOpponent(params, extra);\n\t}\n\n\texecUnreadMessageOpponent(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('dialogues/updateReaded', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tuserId: params.userId,\n\t\t\taction: false\n\t\t});\n\t}\n\n\thandleFileUpload(params, extra)\n\t{\n\t\tif (this.skipExecute(params, extra))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.store.dispatch('files/set', this.controller.prepareFilesBeforeSave(\n\t\t\t VuexBuilderModel.convertToArray({file: params.fileParams})\n\t\t)).then(() => {\n\t\t\tthis.controller.emit(EventType.dialog.scrollToBottom, {cancelIfScrollChange: true});\n\t\t});\n\t}\n}\n\nexport {ImPullCommandHandler};","/**\n * Bitrix Messenger\n * Bundle pull command handlers\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nimport {ImPullCommandHandler} from \"./im.command.handler.js\";\n\nexport {\n\tImPullCommandHandler,\n}"],"names":["ImPullCommandHandler","params","controller","store","option","handlingDialog","chatId","dialogId","PullClient","SubscriptionType","Server","extra","skip","console","info","parseInt","toString","handleMessageAdd","skipExecute","chat","dispatch","fields","users","VuexBuilderModel","convertToArray","files","forEach","file","prepareFilesBeforeSave","length","message","templateFileId","state","index","id","then","emit","EventType","dialog","scrollToBottom","cancelIfScrollChange","collection","messages","update","templateId","sending","error","senderId","getUserId","isUnreadMessagesLoaded","getChatId","commit","unread","stopOpponentWriting","userId","result","counter","count","command","execMessageUpdateOrDelete","text","textOriginal","blink","action","LIKE","startOpponentWriting","readId","lastId","execReadMessageOpponent","userName","messageId","date","execUnreadMessageOpponent","fileParams"],"mappings":"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"}